// Delivery Management System Schema (PostgreSQL)
// Same models as default schema, but datasource provider is postgresql

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id              String         @id @default(cuid())
  email           String         @unique
  password        String
  name            String
  role            AdminRole      @default(SUPER_ADMIN)
  isActive        Boolean        @default(true)
  createdBy       String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  createdAdmins   Admin[]        @relation("AdminHierarchy")
  creator         Admin?         @relation("AdminHierarchy", fields: [createdBy], references: [id])
  orders          Order[]        @relation("OrderAdmin")
  courierOrders   Order[]        @relation("OrderCourier")
  actionLogs      ActionLog[]
  interfaceConfig InterfaceConfig?

  @@map("admins")
}

enum AdminRole {
  SUPER_ADMIN
  MIDDLE_ADMIN
  LOW_ADMIN
  COURIER
}

model Customer {
  id           String   @id @default(cuid())
  name         String
  phone        String   @unique
  address      String
  preferences  String?
  orderPattern String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  orders       Order[]

  @@map("customers")
}

model Order {
  id              String         @id @default(cuid())
  orderNumber     Int            @unique
  customerId      String
  adminId         String
  courierId       String?
  deliveryAddress String
  deliveryDate    DateTime?
  deliveryTime    String
  quantity        Int            @default(1)
  calories        Int
  specialFeatures String?
  paymentStatus   PaymentStatus
  paymentMethod   PaymentMethod
  orderStatus     OrderStatus    @default(PENDING)
  isPrepaid       Boolean        @default(false)
  deliveredAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  customer  Customer @relation(fields: [customerId], references: [id])
  admin     Admin    @relation("OrderAdmin", fields: [adminId], references: [id])
  courier   Admin?   @relation("OrderCourier", fields: [courierId], references: [id])

  @@map("orders")
}

enum PaymentStatus {
  PAID
  UNPAID
}

enum PaymentMethod {
  CARD
  CASH
}

enum OrderStatus {
  PENDING
  IN_DELIVERY
  PAUSED
  DELIVERED
  FAILED
}

model ActionLog {
  id          String   @id @default(cuid())
  adminId     String
  action      String
  entityType  String
  entityId    String
  oldValues   String?
  newValues   String?
  description String?
  createdAt   DateTime @default(now())

  admin Admin @relation(fields: [adminId], references: [id])

  @@map("action_logs")
}

model InterfaceConfig {
  id           String   @id @default(cuid())
  adminId      String   @unique
  buttonConfig String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  admin Admin @relation(fields: [adminId], references: [id])

  @@map("interface_configs")
}
